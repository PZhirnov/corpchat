# Корпортаивный чат на asyncio - приложение для закрытой корпоративной сети


<details>
<summary>
   <strong>
      Информация об оформлении коммитов
   </strong>
</summary>

- **feat:** (новая функционал кода, БЕЗ учёта функционала для сборок)
- **devops:** (функционал для сборки, - добавление, удаление и исправление)
- **fix:** (исправление ошибок функционального кода)
- **docs:** (изменения в документации)
- **style:** (форматирование, отсутствующие точки с запятой и т.п., без изменения производственного кода)
- **refactor:** (рефакторинг производственного кода, например, переименование переменной)
- **test:** (добавление недостающих тестов, рефакторинг тестов; без изменения производственного кода)
- **chore:** (обновление рутинных задач и т. д.; без изменения производственного кода).

Пример коммита `feat: Add schemas`

</details>

## Инструкция по запуску

### Работа с БД

Проект может работать со следующими БД:

- postgresql;
- sqlite.

Для работы с **postgresql** необходимо задать `DATABASE_USED=postgresql` в файл
переменных окружения (`.env`), при задании иного значения будет использоваться
база данных `sqlite`.

> Для работы с postgresql можно использовать docker-контейнер:
> ```
> docker run --name corpchat_postgres -p <POSTGRES_PORT>:5432 -e POSTGRES_USER=<POSTGRES_USER>   -e POSTGRES_PASSWORD=<POSTGRES_PASSWORD> -e POSTGRES_DB=<POSTGRES_DATABASE_NAME> --restart unless-stopped -d postgres:alpine
> ```
> _Примечание_ - Значения в `<>` должны соответствовать значениям файла
> переменных окружения (`.env`).

> Пример:
> ```
> docker run --name corpchat_postgres -p 5433:5432 -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgres -e POSTGRES_DB=database --restart unless-stopped -d postgres:alpine
> ```

### Работа с docker-compose

Для корректной сборки всего проекта необходимо:

1. Перенести файлы полученные командой `npm run build` (директория build) на
   стороне frontend-части в директорию `frontend_build` на backend-части (именно
   содержание, а не саму директорию).
2. Запустить сборку docker-compose (можно запустить в режиме "демона" добавив ключ `-d`):
   ```
   docker-compose up --build --remove-orphan
   ```

Для остановки необходимо ввести команду:

```
docker-compose down
```

___

**ВАЖНО!!** Для проброса директории postgresql (для сохранения данных в БД)
можно раскомментировать в `docker-compose.yml` следующие строчки:

```yaml
#    volumes:
#      - ${POSTGRES_DATA_VOLUME}:/var/lib/postgresql/data/
```

При этом файлы БД будут создаваться в директории `postgres_data`, однако работа
с ними происходит под пользователем root (если работаете не под ним
необходимо будет подменить права на директорию при работе под unix):

```shell
sudo chown <you user>:<you group> postgres_data/
```

**ВАЖНО!!** Также необходимо в дальнейшем создать корректные скрипты создания
суперпользователя по умолчанию (без очистки БД).

### При разработке

Для запуска приложения необходимо:

1. Скопировать шаблон-файл переменных окружения `.env.example` и переименовать копию в `.env`.
2. Ввести свои настройки в `.env` (с настройками по-умолчанию работать не безопасно).
3. Создать виртуальное окружение (интерпретатор при разработке `python = "^3.9.15"`)
   и установить зависимости из `requirements.txt`.
   ```shell
   pip install -r requirements.txt
   ```

   _Примечание_ - _При работе с другими инструментами управления зависимостями при_
   _установке новых зависимостей **в обязательном порядке** сохраняем их в `requirements.txt`._
4. После активации виртуального окружения необходимо перейти в корневую директорию проекта и
   провести миграции существующих приложений:
   ```shell
   cd skillsproject
   python manage.py migrate
   ```
5. При необходимости можно запустить скрипты по заполнению БД тестовыми
   данными ([подробнее...](#описание-скриптов-для-заполнения-бд)).
6. Подгрузить конфигурацию админ панели
   приложения ([подробнее...](#настройка-админ-панели)).

**ВАЖНО!!** При работе контейнера медиа данные сохраняются в "проброшенной" директории
`skillsproject/media` (также под пользователем `root`).
___

Начало работы:  
**ВАЖНО!!** Вы должны работать в пределах каталога своего приложения.
**ВНЕСЕНИЕ ИЗМЕНЕНИЙ В ДРУГОЙ БЛОК ДОЛЖНО СОГЛАСОВЫВАТЬСЯ С ЕГО РАЗРАБОТЧИКОМ.**

1. Все маршруты уже настроены и ваша задача работать с API вашего блока.  
   Пример начального маршрута: http://127.0.0.1:8000/api/doc/  
   Далее вы строите маршрут в urls.py вашего приложения.
   Мастер urls не трогаете.

3. Модель пользователя находится в authapp и на нее делаете свои ссылки.

4. В приложении `referapp` хранятся модели справочников и сериализаторов для них.  
   **ВАЖНО:** в данном приложении сделаны соответствующие папки,
   где в отдельных файлах вы добавляете свои модели справочников.
   Посмотрите как сделана ссылка на справочник из models для authapp:
   ```python
   from referapp.models.general import Company, Department, EmployeePosition, UserRole
   ```
   Все делаем аналогично.

5. В каталоге `skillsproject\mainapp\management\commands` добавляем файлы скриптов.
   Для своих блоков можно создать аналогичные скрипты.

Каждый для своего блока должен сделать аналогичные скрипты для заполнения БД тестовыми данными,
которые будут использоваться в процессе отладки.
(2-3 записи со всеми связями).


```
